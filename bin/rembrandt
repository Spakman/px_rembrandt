#!/opt/bin/ruby
require 'optparse'
require "#{File.dirname(__FILE__)}/../lib/named_pipe_listener"

options = { pipe: "/tmp/rembrandt.fifo", output: "/dev/shm/lcd.png" }

OptionParser.new do |opts|
  opts.banner = "Usage: rembrandt [options]"

  opts.on("-h", "--help", "Show this message") do
    puts opts
    exit
  end

  opts.on("-p", "--pipe [FILEPATH]", "Connect to this named pipe") do |pipe|
    options[:pipe] = pipe
  end

  opts.on("-o", "--output [FILEPATH]", "The filepath for the outputted PNG") do |filepath|
    options[:output] = filepath
  end
end.parse!

listener = Rembrandt::NamedPipeListener.new options[:pipe], options[:output]
listener.listen_and_process
