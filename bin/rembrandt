#!/opt/bin/ruby
#
# Copyright (C) 2009 Mark Somerville <mark@scottishclimbs.com>
# Released under the General Public License (GPL) version 3.
# See COPYING

require 'optparse'
require_relative "../lib/named_pipe_listener"

options = { pipe: "/tmp/rembrandt.fifo", output: "/dev/shm/lcd.png" }

OptionParser.new do |opts|
  opts.banner = "Usage: rembrandt [options]"

  opts.on("-h", "--help", "Show this message") do
    puts opts
    exit
  end

  opts.on("-p", "--pipe [FILEPATH]", "Connect to this named pipe") do |pipe|
    options[:pipe] = pipe
  end

  opts.on("-o", "--output [FILEPATH]", "The filepath for the outputted PNG") do |filepath|
    options[:output] = filepath
  end
end.parse!

listener = Rembrandt::NamedPipeListener.new options[:pipe], Rembrandt::Renderer.new(options[:output])
listener.listen_and_process
